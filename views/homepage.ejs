<% include partials/navbar.ejs %>

  <div class="container theme-showcase" role="main">
    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <img src="/images/banner.png" alt="Mountain View">
    </div>

    <form class="form-horizontal">
      <div class="form-group">

        <div class="col-md-3">
          <div class="input-group">
            <div class="input-group-btn">
              <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">国家 <span class="caret"></span></button>
              <ul class="dropdown-menu" id="country-menu">
              </ul>
            </div>
            <!-- /btn-group -->
            <input type="text" name="country" class="form-control" readonly="" aria-label="...">
          </div>
          <!-- /input-group -->
        </div>
        <!-- /.col-md -->

        <div class="col-md-3">
          <div class="input-group">
            <div class="input-group-btn">
              <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">城市 <span class="caret"></span></button>
              <ul class="dropdown-menu" id="city-menu">
              </ul>
            </div>
            <!-- /btn-group -->
            <input type="text" name="city" class="form-control" readonly="" aria-label="...">
          </div>
          <!-- /input-group -->
        </div>
        <!-- /.col-md -->

        <div class="col-md-3">
          <div class="input-group ">
            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar" ></span></span>
            <input type="text" name="daterange" readonly="" class="form-control" value="01/01/2017 - 01/01/2018" />
          </div>
        </div>
        <!-- /.col-md -->

        <div class="col-md-2">
          <div class="input-group ">
            <span class="input-group-addon"><span class="glyphicon glyphicon-user" ></span></span>
            <input type="number" class="form-control" value=1 min=1 max=10 />
          </div>
        </div>
        <!-- /.col-md -->

        <div class="col-md-1">
          <button type="submit" class="btn btn-success form-control">
            <span class="glyphicon glyphicon-search" ></span>
          </button>
        </div>
        <!-- /.col-md -->
      </div>
      <!-- form-group -->

      <div class="form-group">
        <div class="checkbox col-md-2">
          <label>
            <input type="checkbox" value="">
           无车向导
          </label>
        </div>
        <!-- div.checkbox -->

        <div class="checkbox col-md-2">
          <label>
            <input type="checkbox" value="">
            带车向导
          </label>
        </div>
        <!-- div.checkbox -->

        <div class="checkbox col-md-2">
          <label>
            <input type="checkbox" value="">
            住房
          </label>
        </div>
        <!-- div.checkbox -->

      </div>
      <!-- form-group -->
    </form>

    <ol class="breadcrumb">
      <li class="active">房源</li>
      <li><a href="/gallery/car">带车向导</a></li>
      <li><a href="/gallery/guide">无车向导</a></li>
    </ol>

    <div id="gallery-root"></div>

    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
        <li data-target="#carousel-example-generic" data-slide-to="1"></li>
        <li data-target="#carousel-example-generic" data-slide-to="2"></li>
      </ol>

      <!-- Wrapper for slides -->
      <div class="carousel-inner" role="listbox">
        <div class="item active">
          <img src="/images/1.jpg" alt="...">
          <div class="carousel-caption">1st Pic</div>
        </div>
        <div class="item">
          <img src="/images/2.jpg" alt="...">
          <div class="carousel-caption">2nd Pic</div>
        </div>
        <div class="item ">
          <img src="/images/3.jpg" alt="...">
          <div class="carousel-caption">3rd Pic</div>
        </div>
      </div>

      <!-- Controls -->
      <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

  </div>
  <script>
    /* data */
    var countries = [
      { id: 'usa', text: '美国' },
      { id: 'japan', text: '日本' },
    ];
    var cities = [
      { id: 'boston', text: '波士顿', par: 'usa' },
      { id: 'nycity', text: '纽约', par: 'usa' },
      { id: 'dc', text: '华盛顿', par: 'usa' },

      { id: 'tokyo', text: '东京', par: 'japan' },
    ];
    /* end data */

    $(document).ready(function () {
      $.post("/house/recent", { batchSize: 3 }, (data) => {
        var model = data.map(function (e) {
          var rr = parseInt(1 + Math.random() * 5);
          return {
            title: `$${e.price} ${e.city} ${e.housename}`,
            imageLink: e.housepic_fd ? `/message/snapshot/${e.housepic_fd}` : '/images/img-missing.png',
            detail: ` ${e.housetype} &nbsp， ${e.bedroomcount} 室 ${e.livingroomcount} 厅 ${e.bathroomcount} 卫`,
            btnText: "查看详情",
            btnLink: `/house/__g/${e.id}`,
            btnText2: "查看地图",
            btnLink2: '#',
            reviewCount: 428,
            fiveStarStyles: Array(rr).fill('fa-star').concat(Array(5 - rr).fill('fa-star-o')),
          }
        });

        while (model.length > 0) {
          var str = "<div class='row'>";
          model.slice(0, 3).forEach(function (element) {
            str += cli_render_bind(element, 'gallery_tile_1x3_btn2_star5');
          });
          str += "</div>";
          $('#gallery-root').append(str);

          model.splice(0, 3);
        }

      });

      $('input[name="daterange"]').daterangepicker();

      countries.forEach(function (e, idx) {
        $('#country-menu').append(`<li><a id=${e.id} class='input-link' target='country'>${e.text}</a></li>`)
      });

      cities.forEach(function (e, idx) {
        $('#city-menu').append(`<li><a id=${e.id} par=${e.par} class='input-link' target='city'>${e.text}</a></li>`)
      });

    });

    $(document).on('click', 'a.input-link', function (e) {
      e.preventDefault();
      var t = $(this).attr('target');
      var oldValue = $(`input[name=${t}]`).val();
      if (oldValue !== $(this).text()) {
        $(`input[name=${t}]`).val($(this).text()).trigger('change')
      }
    });

    $('input[name="country"]').on("change", function () {
      $('input[name="city"]').val("");
      $('#city-menu a.input-link').hide();

      var current_country = countries.find((elem) => { return elem.text === $(this).val() });

      $('#city-menu a.input-link').filter((idx, elem) => {
        return $(elem).attr('par') === current_country.id;
      }).show();
    });

    $(window).on('load', function () {
      //console.log(this['JST']);  diffs window.onload vs document.ready
      //var jst_modal = this['JST']['assets/templates/modal1.html']({ id: 'modalEx1', title: 'Oh yeah!', body: '... ... ...' });
      //$('#modal-btn1').after(jst_modal);
    });
  </script>